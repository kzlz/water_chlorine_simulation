\# 基于 WNTR 的管网余氯模拟项目



\## 1. 项目简介



本项目使用 Python 的 `wntr` 库对 EPANET 的经典管网模型 \*\*Net3\*\* 进行二次开发，旨在模拟管网中余氯（Chlorine）的时空分布特性。



项目的主要功能是加载标准的管网文件，以编程方式将其从“水龄”模拟模式转换为“余氯”模拟模式，设置加氯源和衰减系数，最终运行模拟并以图表形式将结果可视化。



\## 2. 环境要求与安装



本项目在以下环境中开发和测试：

\* 操作系统: Windows

\* Python 版本: 3.11+

\* 主要依赖库:

&nbsp;   \* `wntr`

&nbsp;   \* `matplotlib`

&nbsp;   \* `pandas`

&nbsp;   \* `numpy`



您可以通过以下命令快速安装所有必要的依赖库：

```bash

pip install wntr matplotlib pandas numpy

基于少点监测数据的管网余氯全域预测：
第一阶段成果与现状 (2025-09-17)
状态：已完成 :white_check_mark:

我们已经成功搭建并运行了一个 GNN-GRU 基线模型。通过解决数据索引问题，程序现在可以完整地执行数据预处理、模型训练、评估和结果可视化流程（程序正常退出，Exit Code 0）。

这个基线模型验证了技术路线的可行性，并为后续的优化和创新提供了一个可量化的比较标准。当前模型在随机选择的5个传感器基础上，对全网余氯的预测已经达到了一个不错的精度（测试集 MSE ≈ 0.000785）。

第二阶段：传感器布局优化 (当前任务)
目标： 证明通过智能算法优化传感器的安放位置，可以用同样数量（甚至更少）的传感器，达到比随机布局更高的预测精度。这是论文的第一个核心创新点。

实施步骤：

定义评估函数：

创建一个函数，输入为一组传感器节点位置，输出为模型的最终预测精度（例如，在测试集上的 MSE 或 MAE）。我们可以把 train_gnn_gru.py 的核心逻辑封装进这个函数。

实现优化算法：

方法A (贪心算法 - Greedy Algorithm):

从一个空集开始。

循环 N 次（N 是传感器的目标数量）：遍历所有还未被选中的节点，将每一个临时加入传感器集合，训练并评估模型。

选择那个能带来最大精度提升的节点，并将其永久加入传感器集合。

这个方法直观且有效，非常适合作为论文中的一个对比方法。

方法B (遗传算法 - Genetic Algorithm):

这是一种更高级的仿生优化算法，能更好地探索全局最优解。

编码： 将一组传感器布局编码为一个“染色体”（例如，一个包含节点ID的列表）。

种群： 随机生成多个“染色体”作为初始种群。

适应度： 使用我们定义的评估函数来计算每个“染色体”（即每种布局）的好坏。

选择、交叉、变异： 模拟生物进化，保留优良的布局，并将它们进行组合（交叉）或微小改动（变异），生成下一代种群。

重复迭代，直到找到最优或次优的传感器布局。

实验与分析：

运行优化算法，找到最优的5个传感器布局。

将“最优布局”的预测结果与多次“随机布局”的平均结果进行对比。

使用图表和统计数据（如箱形图）清晰地展示优化布局的优越性。

第三阶段：模型结构创新与比较
目标： 在最优传感器布局的基础上，探索和比较不同深度学习模型的性能，找到最适合此任务的模型架构。这是论文的第二个核心创新点。

...（后续计划保持不变）...
